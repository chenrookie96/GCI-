# DRL-TSBC 实验结果和可视化要求

本文档记录了论文中需要实现的所有实验结果展示和可视化图表要求。

## 1. 训练过程可视化

### 图 2-9: 奖励函数中 ζ = 0 时的测试结果

**图表类型**: 双Y轴折线图

**数据要求**:
- X轴: Episode (训练轮次，范围约 0-18)
- 左Y轴: 平均奖励 (范围约 1.71-1.76)
- 右Y轴: 发车次数 (范围约 50-180)

**曲线内容**:
1. 平均奖励 (蓝色线，左Y轴)
2. 上行发车次数 (橙色线，右Y轴)
3. 下行发车次数 (紫色线，右Y轴)

**可视化特点**:
- 显示训练初期平均奖励快速下降
- 上下行发车次数在训练初期差异较大
- 随着训练进行，发车次数逐渐趋于平衡

---

### 图 2-10: 删去状态空间中 $x_m^4$ 和 $y_m^4$ 后测试结果

**图表类型**: 双Y轴折线图

**数据要求**:
- X轴: Episode (训练轮次，范围约 0-18)
- 左Y轴: 平均奖励 (范围约 0.6-1.8)
- 右Y轴: 发车次数 (范围约 60-120)

**曲线内容**:
1. 平均奖励 (蓝色线，左Y轴)
2. 上行发车次数 (橙色线，右Y轴)
3. 下行发车次数 (紫色线，右Y轴)

**可视化特点**:
- 上下行发车次数波动较大，难以平衡
- 平均奖励波动明显
- 证明状态空间中发车次数差异特征的重要性

---

### 图 2-11: DRL-TSBC 的收敛结果

**图表类型**: 双Y轴折线图

**数据要求**:
- X轴: Episode (训练轮次，范围约 0-18)
- 左Y轴: 平均奖励 (范围约 -1.5 到 2.0)
- 右Y轴: 发车次数 (范围约 40-160)

**曲线内容**:
1. 平均奖励 (蓝色线，左Y轴)
2. 上行发车次数 (橙色线，右Y轴)
3. 下行发车次数 (紫色线，右Y轴)

**可视化特点**:
- 训练初期(0-4 episode)平均奖励快速上升
- 第4个episode后趋于稳定
- 上下行发车次数在收敛后保持一致
- 展示算法的良好收敛性

---

## 2. 参数敏感性分析

### 图 2-8: DRL-TSBC 在不同 ω 下的 211 线发车次数与乘客平均等待时间的对比

**图表类型**: 双Y轴折线图

**数据要求**:
- X轴: ω 值 (1/500, 1/1000, 1/2000, 1/3000, 1/4000)
- 左Y轴: 发车次数 (范围约 52-78)
- 右Y轴: 乘客平均等待时间 (分钟，范围约 3-8)

**曲线内容**:
1. NDT (发车次数，蓝色线，左Y轴) - 随ω增大而减少
2. AWT upward (上行平均等待时间，橙色线，右Y轴) - 随ω增大而增加
3. AWT downward (下行平均等待时间，紫色线，右Y轴) - 随ω增大而增加

**可视化特点**:
- 展示ω参数对发车次数和等待时间的权衡关系
- ω越小，发车次数越多，等待时间越短
- ω越大，发车次数越少，等待时间越长

---

### 表 2-4: DRL-TSBC 在不同 ω 下的测试结果

**表格类型**: 对比表格

**数据内容**:

| ω | 线路208 | | | 线路211 | | |
|------|---------|---------|---------|---------|---------|---------|
| | 发车次数 | 上行AWT | 下行AWT | 发车次数 | 上行AWT | 下行AWT |
| 1/500 | 89 | 2.6 | 2.5 | 77 | 3.4 | 3.1 |
| 1/1000 | 77 | 3.5 | 3.3 | 68 | 4.8 | 3.9 |
| 1/2000 | 72 | 3.8 | 4.0 | 58 | 6.7 | 5.8 |
| 1/3000 | 70 | 4.7 | 4.2 | 54 | 7.9 | 6.5 |
| 1/4000 | 64 | 4.9 | 4.9 | 52 | 7.8 | 6.5 |

**说明**: AWT = Average Waiting Time (平均等待时间，单位：分钟)

---

## 3. 客流变化适应性测试

### 图 2-6: 提前晚高峰前后 DRL-TSBC 生成的公交时刻表提供的总客运量与真实需求的对比

**图表类型**: 多曲线折线图

**数据要求**:
- X轴: 时间 (7:00 - 21:00，每30分钟一个数据点)
- Y轴: 总客运量 (范围约 0-350)

**曲线内容**:
1. 调整前 (蓝色线) - 原始时刻表提供的客运量
2. 调整前的真实需求 (青色线) - 原始客流需求
3. 调整后 (红色线) - 提前晚高峰后的时刻表客运量
4. 调整后的真实需求 (橙色线) - 提前晚高峰后的客流需求

**可视化特点**:
- 展示晚高峰提前1小时的场景
- 原晚高峰时段(18:00-19:00)客流减少
- 新晚高峰时段(17:00-18:00)客流增加
- DRL-TSBC能够适应客流变化

---

### 图 2-7: 提前晚高峰前后 DRL-TSBC 生成的公交时刻表提供的上下行客运容量对比

**图表类型**: 多曲线折线图

**数据要求**:
- X轴: 时间 (7:00 - 21:00)
- Y轴: 总客运量 (范围约 0-350)

**曲线内容**:
1. 上行 (蓝色线) - 上行方向提供的客运量
2. 上行真实需求 (青色线) - 上行方向真实需求
3. 下行 (绿色线) - 下行方向提供的客运量
4. 下行真实需求 (黄绿色线) - 下行方向真实需求

**可视化特点**:
- 分别展示上下行方向的客运量匹配情况
- 早高峰(7:00-9:00)和晚高峰(17:00-19:00)明显
- 上下行客流模式不同

---

### 图 2-5: 增加晚高峰客流前后 DRL-TSBC 生成的公交时刻表提供的总客运量与真实需求的对比

**图表类型**: 多曲线折线图

**数据要求**:
- X轴: 时间 (7:00 - 21:00)
- Y轴: 总客运量 (范围约 0-400)

**曲线内容**:
1. 调整前 (蓝色线)
2. 调整前的真实需求 (青色线)
3. 调整后 (红色线)
4. 调整后的真实需求 (橙色线)

**可视化特点**:
- 展示晚高峰客流增加20%的场景
- 晚高峰时段(17:00-19:00)客流明显增加
- DRL-TSBC能够动态调整发车计划

---

## 4. 算法对比实验

### 图 2-4: DRL-TSBC 在 208 线上下行方向生成的公交时刻表所提供的总客运容量与真实需求的对比

**图表类型**: 多曲线折线图

**数据要求**:
- X轴: 时间 (7:00 - 21:00)
- Y轴: 总客运量 (范围约 0-350)

**曲线内容**:
1. 上行 (蓝色线) - DRL-TSBC上行客运量
2. 上行真实需求 (青色线)
3. 下行 (橙色线) - DRL-TSBC下行客运量
4. 下行真实需求 (绿色线)

**可视化特点**:
- 展示208线路的实际应用效果
- 客运量与需求匹配良好
- 早晚高峰明显

---

### 图 2-3: DRL-TSBC 与人工方案生成的公交时刻表所提供的总客运容量在 208 线上行方向的对比

**图表类型**: 多曲线折线图

**数据要求**:
- X轴: 时间 (7:00 - 21:00)
- Y轴: 总客运量 (范围约 0-350)

**曲线内容**:
1. 真实需求 (蓝色线) - 实际客流需求
2. 人工方案 (橙色线) - 现有人工排班方案
3. DRL-TSBC (红色线) - 本文提出的双向算法

**可视化特点**:
- 对比三种方案的客运量供给
- DRL-TSBC与真实需求匹配最好
- 早高峰(7:00-9:00)和晚高峰(17:00-19:00)的表现对比

---

### 表 2-3: 人工方案和 DRL-TSBC 的时刻表排班实验结果

**表格类型**: 综合对比表格

**数据内容**:

#### 线路 208

| 方法 | 方向 | 发车次数 | 乘客平均等待时间(m) | 被滞留乘客数量 | ω |
|------|------|----------|---------------------|----------------|-----|
| 人工方案 | 上行 | 72 | 4.06 | 3 | - |
| 人工方案 | 下行 | 72 | 4.6 | 176 | - |
| DRL-TSBC | 上行 | 73 | 3.7 | 0 | 1/1000 |
| DRL-TSBC | 下行 | 73 | 3.8 | 0 | 1/1000 |

#### 线路 211

| 方法 | 方向 | 发车次数 | 乘客平均等待时间(m) | 被滞留乘客数量 | ω |
|------|------|----------|---------------------|----------------|-----|
| 人工方案 | 上行 | 76 | 4.68 | 0 | - |
| 人工方案 | 下行 | 76 | 3.5 | 0 | - |
| DRL-TSBC | 上行 | 75 | 4.0 | 0 | 1/900 |
| DRL-TSBC | 下行 | 75 | 3.3 | 0 | 1/900 |

**关键指标**:
- 发车次数: 体现运营成本
- 乘客平均等待时间: 体现服务质量
- 被滞留乘客数量: 体现服务可靠性
- ω: 各方法使用的等待时间惩罚参数

---

## 5. 实现要求总结

### 5.1 必须实现的图表

1. **训练过程可视化** (3个图)
   - 图2-9: ζ=0时的训练结果
   - 图2-10: 删除状态特征后的训练结果
   - 图2-11: 完整算法的收敛曲线

2. **参数敏感性分析** (1图1表)
   - 图2-8: ω参数对性能的影响
   - 表2-4: 不同ω值的详细结果

3. **客流适应性测试** (3个图)
   - 图2-5: 增加晚高峰客流测试
   - 图2-6: 提前晚高峰测试(总量)
   - 图2-7: 提前晚高峰测试(上下行分开)

4. **算法对比** (2图1表)
   - 图2-3: DRL-TSBC与人工方案的客运量对比
   - 图2-4: 208线上下行对比
   - 表2-3: 综合性能对比表

### 5.2 可视化技术要求

**图表库选择**:
- Python: matplotlib / seaborn / plotly
- 支持双Y轴绘图
- 支持多曲线叠加
- 支持中文标签

**图表样式**:
- 清晰的图例
- 网格线辅助阅读
- 合适的颜色区分(蓝、橙、紫、绿等)
- 标准的坐标轴标签

**数据格式**:
- 训练过程数据需要在训练时记录
- 时刻表数据需要按时间段统计
- 对比数据需要多次运行取平均

### 5.3 实验场景设置

1. **正常场景**: 使用历史数据训练和测试
2. **客流增加场景**: 晚高峰客流增加20%
3. **客流时移场景**: 晚高峰提前1小时
4. **消融实验**: 移除关键特征或参数

---

## 6. 数据记录要求

### 训练阶段需要记录:
- 每个episode的平均奖励
- 每个episode的上下行发车次数
- 网络损失值
- 探索率ε的变化

### 测试阶段需要记录:
- 生成的时刻表(发车时间列表)
- 每个时间段的客运容量
- 乘客平均等待时间
- 被滞留乘客数量
- 上下行发车次数

### 对比实验需要记录:
- 人工方案的时刻表和性能指标
- DRL-TSBC的时刻表和性能指标
- 真实客流需求数据

---

**注意事项**:
1. 所有图表需要保存为高分辨率图片(至少300dpi)
2. 数据需要保存为CSV或JSON格式便于后续分析
3. 实验结果需要可复现，设置随机种子
4. 多次运行取平均值以减少随机性影响
