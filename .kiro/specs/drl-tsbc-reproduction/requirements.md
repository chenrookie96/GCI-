# 需求文档

## 简介

本文档概述了复现谢嘉昊研究论文中DRL-TSBC（基于深度强化学习的双向动态公交时刻表排班算法）的需求。目标是创建一个完整的、逐步的复现过程，与论文的方法论、参数和实验结果保持一致，包括生成论文中显示的对比图表和表格。

## 术语表

- **DRL-TSBC**: 基于深度强化学习的双向动态公交时刻表排班算法
- **DQN**: 深度Q网络，算法中使用的神经网络架构
- **双向约束**: 确保上行和下行方向发车次数相等
- **公交仿真器**: 模拟公交运营和客流的仿真环境
- **客流数据**: 用于训练和测试的真实乘客刷卡数据
- **时刻表排班**: 确定公交车何时从首站发车的过程
- **GPU训练**: 使用与RTX 4060兼容的CUDA 11.8训练神经网络
- **奖励函数**: 指导DQN学习过程的函数
- **状态空间**: 表示当前系统状态的10维特征向量
- **动作空间**: 两个方向发车决策的4种可能组合

## 需求

### 需求 1

**用户故事:** 作为研究者，我希望验证现有实现与论文规范匹配，以便在进行实验之前确保准确性。

#### 验收标准

1. WHEN 检查当前代码库时，THE 系统 SHALL 验证所有算法参数与论文中指定的参数匹配（μ=5000, δ=200, β=0.2, ζ=0.002）
2. WHEN 检查DQN网络结构时，THE 系统 SHALL 确认它使用表2-2中指定的12个隐藏层，每层500个神经元
3. WHEN 检查状态空间实现时，THE 系统 SHALL 验证它包含方程(2.1)中定义的确切10个维度
4. WHEN 检查奖励函数时，THE 系统 SHALL 确保正确实现方程(2.16)和(2.17)
5. THE 系统 SHALL 确认GPU支持已正确配置为CUDA 11.8和RTX 4060

### 需求 2

**用户故事:** 作为研究者，我希望准备和验证数据集，以便训练数据与论文的实验设置匹配。

#### 验收标准

1. WHEN 从test_data目录加载乘客数据时，THE 系统 SHALL 处理208、211和683路线的数据
2. WHEN 预处理乘客数据时，THE 系统 SHALL 按照2.4.1节描述使用正态分布估算乘客到达时间
3. WHEN 设置公交参数时，THE 系统 SHALL 将座位数配置为32，α配置为1.5
4. WHEN 验证数据格式时，THE 系统 SHALL 确保每条记录包含乘客ID、上车时间、上车站点、下车站点和到达时间
5. THE 系统 SHALL 生成与双向公交仿真器兼容的客流矩阵

### 需求 3

**用户故事:** 作为研究者，我希望完全按照论文描述配置训练环境，以便结果可重现。

#### 验收标准

1. WHEN 设置仿真环境时，THE 系统 SHALL 使用分钟级粒度进行决策
2. WHEN 配置服务时间时，THE 系统 SHALL 设置运营时间与论文匹配（208路6:00-21:00，211路6:00-22:00）
3. WHEN 初始化DQN网络时，THE 系统 SHALL 使用表2-2中的确切超参数
4. WHEN 设置约束时，THE 系统 SHALL 实现Tmin和Tmax间隔约束
5. THE 系统 SHALL 配置经验回放缓冲区大小为3000，批次大小为64

### 需求 4

**用户故事:** 作为研究者，我希望通过适当的监控训练DRL-TSBC模型，以便跟踪收敛和性能。

#### 验收标准

1. WHEN 开始训练时，THE 系统 SHALL 初始化主网络和目标DQN网络
2. WHEN 训练进行时，THE 系统 SHALL 每100个学习步骤更新目标网络
3. WHEN 收集经验时，THE 系统 SHALL 在回放缓冲区中存储状态-动作-奖励-下一状态元组
4. WHEN 回放缓冲区满时，THE 系统 SHALL 每5步执行一次学习
5. THE 系统 SHALL 跟踪和记录训练指标，包括平均奖励、epsilon衰减和发车次数

### 需求 5

**用户故事:** 作为研究者，我希望评估训练模型与基线方法的对比，以便复现论文中的比较结果。

#### 验收标准

1. WHEN 测试训练模型时，THE 系统 SHALL 与当前使用的人工调度方法进行比较
2. WHEN 运行离线调度实验时，THE 系统 SHALL 测量平均乘客等待时间、发车次数和滞留乘客
3. WHEN 进行在线调度测试时，THE 系统 SHALL 展示对客流变化的实时适应
4. WHEN 评估双向约束时，THE 系统 SHALL 验证两个方向的发车次数相等
5. THE 系统 SHALL 生成与表2-3格式匹配的性能比较表

### 需求 6

**用户故事:** 作为研究者，我希望生成与论文图表匹配的可视化结果，以便验证复现的准确性。

#### 验收标准

1. WHEN 创建运力与需求对比图时，THE 系统 SHALL 生成类似图2-3和图2-4的图表
2. WHEN 显示在线适应结果时，THE 系统 SHALL 创建类似图2-5、2-6和2-7的可视化
3. WHEN 绘制训练收敛图时，THE 系统 SHALL 显示如图2-11所示的奖励曲线和发车次数平衡
4. WHEN 生成比较图表时，THE 系统 SHALL 显示如图2-8所示不同ω值下的性能
5. THE 系统 SHALL 以高质量格式保存所有可视化结果用于分析

### 需求 7

**用户故事:** 作为研究者，我希望进行消融研究，以便验证每个算法组件的重要性。

#### 验收标准

1. WHEN 测试无双向约束（ζ=0）时，THE 系统 SHALL 展示不等的发车次数
2. WHEN 从状态空间中移除发车次数状态时，THE 系统 SHALL 显示收敛问题
3. WHEN 与DRL-TO算法比较时，THE 系统 SHALL 突出双向调度的优势
4. WHEN 测试不同ω值时，THE 系统 SHALL 显示等待时间和发车频率之间的权衡
5. THE 系统 SHALL 记录所有消融研究结果并提供清晰解释

### 需求 8

**用户故事:** 作为研究者，我希望测试系统对交通变化的鲁棒性，以便验证在线适应能力。

#### 验收标准

1. WHEN 模拟突然的客流增加时，THE 系统 SHALL 相应调整发车时刻表
2. WHEN 测试早/晚高峰时段场景时，THE 系统 SHALL 保持最优调度
3. WHEN 遇到交通拥堵时，THE 系统 SHALL 在不增加车辆数量的情况下适应
4. WHEN 乘客需求动态变化时，THE 系统 SHALL 保持双向平衡
5. THE 系统 SHALL 在分钟级时间粒度内展示实时决策能力