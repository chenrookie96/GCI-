# Implementation Plan

- [x] 1. 修复环境模拟器中的发车逻辑


  - 修改 `src/environment/bidirectional_bus_simulator.py` 中的 `_dispatch_bus` 方法
  - 修正滞留乘客计算逻辑：在更新等待队列之前计算滞留乘客
  - 修正等待时间计算条件：使用 `last_departure_time > 0` 而不是 `>= 0`
  - 调整代码执行顺序：计算上车人数 → 计算滞留乘客 → 更新等待队列 → 计算等待时间
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_



- [ ] 2. 创建诊断和验证脚本
  - 创建 `verify_fix.py` 脚本来验证修复效果
  - 实现单元测试验证滞留乘客计算逻辑
  - 实现单元测试验证等待时间计算逻辑


  - 实现完整episode测试验证最终性能指标
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 3. 运行训练并验证性能
  - 使用修复后的代码运行完整训练（100 episodes）
  - 验证上行平均等待时间在3.5-4.0分钟范围内
  - 验证下行平均等待时间在3.5-4.0分钟范围内


  - 验证上行滞留乘客数量为0或接近0
  - 验证下行滞留乘客数量为0或接近0
  - 验证上下行发车次数差异≤1
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 4. 生成性能对比报告
  - 创建对比表格展示修复前后的性能差异
  - 对比论文表2-3的目标值
  - 生成最终验证报告
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_
